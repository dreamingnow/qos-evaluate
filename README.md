Usage
======================================

Workflow overview
-----------------

1. Preprocessing
2. Insert raw segment log into db
3. Evaluate QoS
4. Insert results into db

Preprocessing
-------------
Raw segment log data files contain 12 columns for a single video chunk.

1. epoch finished
2. transfer time
3. IP (32-bit int)
4. port
5. file size
6. channel
7. HTTP status code
9. bitrate
10. connection sequence number
11. server name
12. user agent / OS

Since the user agent field can be used to judge device type, we use a preprocess script to replace it with OS type.  The results are inserted to MySQL database.  The script `preimport.sh` will do the job.  Usage:

`./preimport.sh <segment_log_file> <db_name> <pipe>`

The `<pipe>` is a pipe generated by `mkfifo` to direct the output to database.  Table structures can be found in `/sql/mobtv-qoe-new.sql`.

Estimate QoE of sessions
------------------------

run `main.py --help` to get the usage.
The input could from a preprocessed file or db queries.  The output file should be specified with `-o <file>`.  It will produce two output files, one for session QoS, and one for stuck epochs.

`run_qoe_db.sh` can be used to feed db records to the scripts.

Output
------

The output of the `main.py` contains:

1. server
2. connection sequence
3. channel
4. bitrate
5. IP
6. OS type: an/ios
7. start time (request time of the first chunk)
8. end time (finish time of the last chunk)
9. total segments
10. number of segments excluding additional segments when buffering
11. average segment download time
12. number of stuck
13. buffering time
14. playback time
15. last stuck epoch
16. last resume epoch

Each line represents a session.

Another output file logs stuch epochs, each line contains:

1. server
2. connection sequence
3. stuck epoch

DB related scripts
------------------

The usage of `importgztab.sh`:
`./importgztab.sh <gz_file> <db> <table> <pipe>`

